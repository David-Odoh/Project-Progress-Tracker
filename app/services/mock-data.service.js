"use strict";
//angular imports
var core_1 = require("@angular/core");
//nativescript imports
var fileSystemModule = require("file-system");
//3rd party imports
var faker = require("faker");
var _ = require("lodash");
//app imports
var constModule = require("../shared/constants");
var static_data_1 = require("../shared/static-data");
var MockDataService = (function () {
    function MockDataService() {
    }
    MockDataService.prototype.generatePTItems = function (users) {
        var _this = this;
        var items = _.times(constModule.NUM_PT_ITEMS, function () {
            return _this.generatePTItem(users);
        });
        return items;
    };
    MockDataService.prototype.generatePTItem = function (users) {
        var date = faker.date.past(1);
        var title = this.toTitleCase(faker.company.bs());
        var typeStr = static_data_1.ItemTypeEnum[_.random(1, 4)];
        var type = static_data_1.ItemTypeEnum[typeStr];
        var priorityStr = static_data_1.PriorityEnum[_.random(1, 4)];
        var priority = static_data_1.PriorityEnum[priorityStr];
        var statusStr = static_data_1.StatusEnum[_.random(1, 4)];
        var status = static_data_1.StatusEnum[statusStr];
        var ptItem = {
            id: faker.random.uuid(),
            title: title,
            dateCreated: date,
            dateModified: date,
            type: type,
            estimate: _.random(1, 24),
            priority: priority,
            status: status,
            assignee: _.sample(users),
            tasks: this.generateTasks(),
            comments: this.generateComments(users)
        };
        return ptItem;
    };
    MockDataService.prototype.generateTasks = function () {
        var _this = this;
        var numTasks = _.random(5, 20);
        var tasks = _.times(numTasks, function () {
            return _this.generateTask();
        });
        return tasks;
    };
    MockDataService.prototype.generateTask = function () {
        var date = faker.date.past(1);
        var title = this.toTitleCase(faker.company.bs());
        var task = {
            id: faker.random.uuid(),
            title: title,
            dateCreated: date,
            dateModified: date,
            completed: faker.random.boolean()
        };
        return task;
    };
    MockDataService.prototype.generateUsers = function () {
        var _this = this;
        //let avatarsMen = this.getUserAvatars('images/avatars/base64/men.txt');
        //let avatarsWomen = this.getUserAvatars('images/avatars/base64/women.txt');
        var avatarsLi = this.getUserLiUserAvatars('images/avatars/base64/base64.txt');
        var users = _.times(constModule.NUM_USERS, function () {
            //return this.generateUser(avatarsMen, avatarsWomen);
            return _this.generateUser(avatarsLi);
        });
        var userMe = this.getMeUser();
        users.unshift(userMe);
        return users;
    };
    MockDataService.prototype.getMeUser = function () {
        var avatarMe = this.getUserAvatars('images/avatars/base64/me.txt')[0];
        var userMe = {
            id: faker.random.uuid(),
            fullName: 'Alex Ziskind',
            avatar: avatarMe
        };
        return userMe;
    };
    MockDataService.prototype.generateUser = function (avatarsMen, avatarsWomen) {
        var genderBool = faker.random.boolean();
        var genderInt = parseInt(genderBool + '');
        var firstName = faker.name.firstName(genderInt);
        var lastName = faker.name.lastName(genderInt);
        var avatar;
        if (avatarsWomen) {
            avatar = genderBool ? _.sample(avatarsMen) : _.sample(avatarsWomen);
        }
        else {
            avatar = _.sample(avatarsMen);
        }
        var user = {
            id: faker.random.uuid(),
            fullName: firstName + ' ' + lastName,
            avatar: avatar
        };
        return user;
    };
    MockDataService.prototype.generateComments = function (users) {
        var _this = this;
        var numComments = _.random(0, 5);
        var comments = _.times(numComments, function () {
            return _this.generateComment(users);
        });
        return comments;
    };
    MockDataService.prototype.generateComment = function (users) {
        var date = faker.date.past(1);
        var commentText = this.toTitleCase(faker.lorem.sentence(20, 40));
        //let commentText = this.toTitleCase(faker.company.bs());
        var comment = {
            id: faker.random.uuid(),
            title: commentText,
            dateCreated: date,
            dateModified: date,
            user: _.sample(users)
        };
        return comment;
    };
    MockDataService.prototype.getUserAvatars = function (path) {
        var avatarList = [];
        var currentAppFolder = fileSystemModule.knownFolders.currentApp();
        var menAvatarsFile = currentAppFolder.getFile(path);
        var fileText = menAvatarsFile.readTextSync();
        var lines = fileText.split('\n');
        for (var i = 0; i < lines.length; i++) {
            avatarList.push('data:image/png;base64,' + lines[i]);
        }
        return avatarList;
    };
    MockDataService.prototype.getUserLiUserAvatars = function (path) {
        var avatarList = [];
        var currentAppFolder = fileSystemModule.knownFolders.currentApp();
        var menAvatarsFile = currentAppFolder.getFile(path);
        var fileText = menAvatarsFile.readTextSync();
        var lines = fileText.split('\n');
        for (var i = 0; i < lines.length; i++) {
            avatarList.push(lines[i]);
        }
        return avatarList;
    };
    MockDataService.prototype.toTitleCase = function (str) {
        return str.replace(/\w\S*/g, function (txt) { return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase(); });
    };
    MockDataService.prototype.pickRandomProperty = function (obj) {
        var result;
        var count = 0;
        for (var prop in obj)
            if (Math.random() < 1 / ++count)
                result = prop;
        return result;
    };
    return MockDataService;
}());
MockDataService = __decorate([
    core_1.Injectable()
], MockDataService);
exports.MockDataService = MockDataService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9jay1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJtb2NrLWRhdGEuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsaUJBQWlCO0FBQ2pCLHNDQUEyQztBQUUzQyxzQkFBc0I7QUFDdEIsOENBQWdEO0FBRWhELG1CQUFtQjtBQUNuQiw2QkFBK0I7QUFDL0IsMEJBQTRCO0FBRTVCLGFBQWE7QUFDYixpREFBbUQ7QUFDbkQscURBQStFO0FBUy9FLElBQWEsZUFBZTtJQUE1QjtJQXFLQSxDQUFDO0lBbktVLHlDQUFlLEdBQXRCLFVBQXVCLEtBQW1CO1FBQTFDLGlCQUtDO1FBSkcsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsWUFBWSxFQUFFO1lBQzFDLE1BQU0sQ0FBQyxLQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3RDLENBQUMsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBRU0sd0NBQWMsR0FBckIsVUFBc0IsS0FBbUI7UUFDckMsSUFBSSxJQUFJLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFakQsSUFBSSxPQUFPLEdBQUcsMEJBQVksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNDLElBQUksSUFBSSxHQUFHLDBCQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFakMsSUFBSSxXQUFXLEdBQUcsMEJBQVksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9DLElBQUksUUFBUSxHQUFHLDBCQUFZ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LENBQUMsQ0FBQztRQUNkLEdBQUcsQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLEdBQUcsQ0FBQztZQUNqQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDO2dCQUM1QixNQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDbEIsQ0FBQztJQUNMLHNCQUFDO0FBQUQsQ0FBQyxBQXJLRCxJQXFLQztBQXJLWSxlQUFlO0lBRDNCLGlCQUFVLEVBQUU7R0FDQSxlQUFlLENBcUszQjtBQXJLWSwwQ0FBZSIsInNvdXJjZXNDb250ZW50IjpbIi8vYW5ndWxhciBpbXBvcnRzXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbi8vbmF0aXZlc2NyaXB0IGltcG9ydHNcbmltcG9ydCAqIGFzIGZpbGVTeXN0ZW1Nb2R1bGUgZnJvbSAnZmlsZS1zeXN0ZW0nO1xuXG4vLzNyZCBwYXJ0eSBpbXBvcnRzXG5pbXBvcnQgKiBhcyBmYWtlciBmcm9tICdmYWtlcic7XG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5cbi8vYXBwIGltcG9ydHNcbmltcG9ydCAqIGFzIGNvbnN0TW9kdWxlIGZyb20gJy4uL3NoYXJlZC9jb25zdGFudHMnO1xuaW1wb3J0IHsgSXRlbVR5cGVFbnVtLCBQcmlvcml0eUVudW0sIFN0YXR1c0VudW0gfSBmcm9tICcuLi9zaGFyZWQvc3RhdGljLWRhdGEnO1xuXG5pbXBvcnQgeyBQVERvbWFpbiB9IGZyb20gJy4uL3R5cGluZ3MvZG9tYWluJztcbmltcG9ydCBJVXNlciA9IFBURG9tYWluLklVc2VyO1xuaW1wb3J0IElQVEl0ZW0gPSBQVERvbWFpbi5JUFRJdGVtO1xuaW1wb3J0IElUYXNrID0gUFREb21haW4uSVRhc2s7XG5pbXBvcnQgSUNvbW1lbnQgPSBQVERvbWFpbi5JQ29tbWVudDtcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE1vY2tEYXRhU2VydmljZSB7XG5cbiAgICBwdWJsaWMgZ2VuZXJhdGVQVEl0ZW1zKHVzZXJzOiBBcnJheTxJVXNlcj4pOiBBcnJheTxJUFRJdGVtPiB7XG4gICAgICAgIGxldCBpdGVtcyA9IF8udGltZXMoY29uc3RNb2R1bGUuTlVNX1BUX0lURU1TLCAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZVBUSXRlbSh1c2Vycyk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaXRlbXM7XG4gICAgfVxuXG4gICAgcHVibGljIGdlbmVyYXRlUFRJdGVtKHVzZXJzOiBBcnJheTxJVXNlcj4pOiBJUFRJdGVtIHtcbiAgICAgICAgbGV0IGRhdGUgPSBmYWtlci5kYXRlLnBhc3QoMSk7XG4gICAgICAgIGxldCB0aXRsZSA9IHRoaXMudG9UaXRsZUNhc2UoZmFrZXIuY29tcGFueS5icygpKTtcblxuICAgICAgICBsZXQgdHlwZVN0ciA9IEl0ZW1UeXBlRW51bVtfLnJhbmRvbSgxLCA0KV07XG4gICAgICAgIGxldCB0eXBlID0gSXRlbVR5cGVFbnVtW3R5cGVTdHJdO1xuXG4gICAgICAgIGxldCBwcmlvcml0eVN0ciA9IFByaW9yaXR5RW51bVtfLnJhbmRvbSgxLCA0KV07XG4gICAgICAgIGxldCBwcmlvcml0eSA9IFByaW9yaXR5RW51bVtwcmlvcml0eVN0cl07XG5cbiAgICAgICAgbGV0IHN0YXR1c1N0ciA9IFN0YXR1c0VudW1bXy5yYW5kb20oMSwgNCldO1xuICAgICAgICBsZXQgc3RhdHVzID0gU3RhdHVzRW51bVtzdGF0dXNTdHJdO1xuXG4gICAgICAgIGxldCBwdEl0ZW06IElQVEl0ZW0gPSB7XG4gICAgICAgICAgICBpZDogZmFrZXIucmFuZG9tLnV1aWQoKSxcbiAgICAgICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgICAgIGRhdGVDcmVhdGVkOiBkYXRlLFxuICAgICAgICAgICAgZGF0ZU1vZGlmaWVkOiBkYXRlLFxuICAgICAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgICAgIGVzdGltYXRlOiBfLnJhbmRvbSgxLCAyNCksXG4gICAgICAgICAgICBwcmlvcml0eTogcHJpb3JpdHksXG4gICAgICAgICAgICBzdGF0dXM6IHN0YXR1cyxcbiAgICAgICAgICAgIGFzc2lnbmVlOiBfLnNhbXBsZSh1c2VycyksXG4gICAgICAgICAgICB0YXNrczogdGhpcy5nZW5lcmF0ZVRhc2tzKCksXG4gICAgICAgICAgICBjb21tZW50czogdGhpcy5nZW5lcmF0ZUNvbW1lbnRzKHVzZXJzKVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBwdEl0ZW07XG4gICAgfVxuXG4gICAgcHVibGljIGdlbmVyYXRlVGFza3MoKTogQXJyYXk8SVRhc2s+IHtcbiAgICAgICAgbGV0IG51bVRhc2tzID0gXy5yYW5kb20oNSwgMjApO1xuICAgICAgICBsZXQgdGFza3MgPSBfLnRpbWVzKG51bVRhc2tzLCAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZVRhc2soKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0YXNrcztcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2VuZXJhdGVUYXNrKCk6IElUYXNrIHtcbiAgICAgICAgbGV0IGRhdGUgPSBmYWtlci5kYXRlLnBhc3QoMSk7XG4gICAgICAgIGxldCB0aXRsZSA9IHRoaXMudG9UaXRsZUNhc2UoZmFrZXIuY29tcGFueS5icygpKTtcbiAgICAgICAgbGV0IHRhc2s6IElUYXNrID0ge1xuICAgICAgICAgICAgaWQ6IGZha2VyLnJhbmRvbS51dWlkKCksXG4gICAgICAgICAgICB0aXRsZTogdGl0bGUsXG4gICAgICAgICAgICBkYXRlQ3JlYXRlZDogZGF0ZSxcbiAgICAgICAgICAgIGRhdGVNb2RpZmllZDogZGF0ZSxcbiAgICAgICAgICAgIGNvbXBsZXRlZDogZmFrZXIucmFuZG9tLmJvb2xlYW4oKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGFzaztcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2VuZXJhdGVVc2VycygpOiBBcnJheTxJVXNlcj4ge1xuICAgICAgICAvL2xldCBhdmF0YXJzTWVuID0gdGhpcy5nZXRVc2VyQXZhdGFycygnaW1hZ2VzL2F2YXRhcnMvYmFzZTY0L21lbi50eHQnKTtcbiAgICAgICAgLy9sZXQgYXZhdGFyc1dvbWVuID0gdGhpcy5nZXRVc2VyQXZhdGFycygnaW1hZ2VzL2F2YXRhcnMvYmFzZTY0L3dvbWVuLnR4dCcpO1xuICAgICAgICBsZXQgYXZhdGFyc0xpID0gdGhpcy5nZXRVc2VyTGlVc2VyQXZhdGFycygnaW1hZ2VzL2F2YXRhcnMvYmFzZTY0L2Jhc2U2NC50eHQnKTtcbiAgICAgICAgbGV0IHVzZXJzID0gXy50aW1lcyhjb25zdE1vZHVsZS5OVU1fVVNFUlMsICgpID0+IHtcbiAgICAgICAgICAgIC8vcmV0dXJuIHRoaXMuZ2VuZXJhdGVVc2VyKGF2YXRhcnNNZW4sIGF2YXRhcnNXb21lbik7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZVVzZXIoYXZhdGFyc0xpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGxldCB1c2VyTWUgPSB0aGlzLmdldE1lVXNlcigpO1xuICAgICAgICB1c2Vycy51bnNoaWZ0KHVzZXJNZSk7XG4gICAgICAgIHJldHVybiB1c2VycztcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0TWVVc2VyKCk6IElVc2VyIHtcbiAgICAgICAgbGV0IGF2YXRhck1lID0gdGhpcy5nZXRVc2VyQXZhdGFycygnaW1hZ2VzL2F2YXRhcnMvYmFzZTY0L21lLnR4dCcpWzBdO1xuXG4gICAgICAgIGxldCB1c2VyTWU6IElVc2VyID0ge1xuICAgICAgICAgICAgaWQ6IGZha2VyLnJhbmRvbS51dWlkKCksXG4gICAgICAgICAgICBmdWxsTmFtZTogJ0FsZXggWmlza2luZCcsXG4gICAgICAgICAgICBhdmF0YXI6IGF2YXRhck1lXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB1c2VyTWU7XG4gICAgfVxuXG4gICAgcHVibGljIGdlbmVyYXRlVXNlcihhdmF0YXJzTWVuOiBzdHJpbmdbXSwgYXZhdGFyc1dvbWVuPzogc3RyaW5nW10pOiBJVXNlciB7XG4gICAgICAgIGxldCBnZW5kZXJCb29sID0gZmFrZXIucmFuZG9tLmJvb2xlYW4oKTtcbiAgICAgICAgbGV0IGdlbmRlckludCA9IHBhcnNlSW50KGdlbmRlckJvb2wgKyAnJyk7XG4gICAgICAgIGxldCBmaXJzdE5hbWUgPSBmYWtlci5uYW1lLmZpcnN0TmFtZShnZW5kZXJJbnQpO1xuICAgICAgICBsZXQgbGFzdE5hbWUgPSBmYWtlci5uYW1lLmxhc3ROYW1lKGdlbmRlckludCk7XG4gICAgICAgIHZhciBhdmF0YXI7XG4gICAgICAgIGlmIChhdmF0YXJzV29tZW4pIHtcbiAgICAgICAgICAgIGF2YXRhciA9IGdlbmRlckJvb2wgPyBfLnNhbXBsZShhdmF0YXJzTWVuKSA6IF8uc2FtcGxlKGF2YXRhcnNXb21lbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhdmF0YXIgPSBfLnNhbXBsZShhdmF0YXJzTWVuKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB1c2VyOiBJVXNlciA9IHtcbiAgICAgICAgICAgIGlkOiBmYWtlci5yYW5kb20udXVpZCgpLFxuICAgICAgICAgICAgZnVsbE5hbWU6IGZpcnN0TmFtZSArICcgJyArIGxhc3ROYW1lLFxuICAgICAgICAgICAgYXZhdGFyOiBhdmF0YXJcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHVzZXI7XG4gICAgfVxuXG4gICAgcHVibGljIGdlbmVyYXRlQ29tbWVudHModXNlcnM6IEFycmF5PElVc2VyPik6IEFycmF5PElDb21tZW50PiB7XG4gICAgICAgIGxldCBudW1Db21tZW50cyA9IF8ucmFuZG9tKDAsIDUpO1xuICAgICAgICBsZXQgY29tbWVudHMgPSBfLnRpbWVzKG51bUNvbW1lbnRzLCAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUNvbW1lbnQodXNlcnMpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNvbW1lbnRzO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZW5lcmF0ZUNvbW1lbnQodXNlcnM6IEFycmF5PElVc2VyPik6IElDb21tZW50IHtcbiAgICAgICAgbGV0IGRhdGUgPSBmYWtlci5kYXRlLnBhc3QoMSk7XG4gICAgICAgIGxldCBjb21tZW50VGV4dCA9IHRoaXMudG9UaXRsZUNhc2UoZmFrZXIubG9yZW0uc2VudGVuY2UoMjAsIDQwKSk7XG4gICAgICAgIC8vbGV0IGNvbW1lbnRUZXh0ID0gdGhpcy50b1RpdGxlQ2FzZShmYWtlci5jb21wYW55LmJzKCkpO1xuXG4gICAgICAgIGxldCBjb21tZW50OiBJQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBmYWtlci5yYW5kb20udXVpZCgpLFxuICAgICAgICAgICAgdGl0bGU6IGNvbW1lbnRUZXh0LFxuICAgICAgICAgICAgZGF0ZUNyZWF0ZWQ6IGRhdGUsXG4gICAgICAgICAgICBkYXRlTW9kaWZpZWQ6IGRhdGUsXG4gICAgICAgICAgICB1c2VyOiBfLnNhbXBsZSh1c2VycylcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGNvbW1lbnQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRVc2VyQXZhdGFycyhwYXRoKSB7XG4gICAgICAgIHZhciBhdmF0YXJMaXN0OiBBcnJheTxzdHJpbmc+ID0gW107XG4gICAgICAgIHZhciBjdXJyZW50QXBwRm9sZGVyID0gZmlsZVN5c3RlbU1vZHVsZS5rbm93bkZvbGRlcnMuY3VycmVudEFwcCgpO1xuICAgICAgICB2YXIgbWVuQXZhdGFyc0ZpbGUgPSBjdXJyZW50QXBwRm9sZGVyLmdldEZpbGUocGF0aCk7XG4gICAgICAgIHZhciBmaWxlVGV4dCA9IG1lbkF2YXRhcnNGaWxlLnJlYWRUZXh0U3luYygpO1xuXG4gICAgICAgIHZhciBsaW5lcyA9IGZpbGVUZXh0LnNwbGl0KCdcXG4nKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgYXZhdGFyTGlzdC5wdXNoKCdkYXRhOmltYWdlL3BuZztiYXNlNjQsJyArIGxpbmVzW2ldKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXZhdGFyTGlzdDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFVzZXJMaVVzZXJBdmF0YXJzKHBhdGgpIHtcbiAgICAgICAgdmFyIGF2YXRhckxpc3Q6IEFycmF5PHN0cmluZz4gPSBbXTtcbiAgICAgICAgdmFyIGN1cnJlbnRBcHBGb2xkZXIgPSBmaWxlU3lzdGVtTW9kdWxlLmtub3duRm9sZGVycy5jdXJyZW50QXBwKCk7XG4gICAgICAgIHZhciBtZW5BdmF0YXJzRmlsZSA9IGN1cnJlbnRBcHBGb2xkZXIuZ2V0RmlsZShwYXRoKTtcbiAgICAgICAgdmFyIGZpbGVUZXh0ID0gbWVuQXZhdGFyc0ZpbGUucmVhZFRleHRTeW5jKCk7XG5cbiAgICAgICAgdmFyIGxpbmVzID0gZmlsZVRleHQuc3BsaXQoJ1xcbicpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBhdmF0YXJMaXN0LnB1c2gobGluZXNbaV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhdmF0YXJMaXN0O1xuICAgIH1cblxuICAgIHByaXZhdGUgdG9UaXRsZUNhc2Uoc3RyKSB7XG4gICAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvXFx3XFxTKi9nLCBmdW5jdGlvbiAodHh0KSB7IHJldHVybiB0eHQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0eHQuc3Vic3RyKDEpLnRvTG93ZXJDYXNlKCk7IH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgcGlja1JhbmRvbVByb3BlcnR5KG9iaikge1xuICAgICAgICB2YXIgcmVzdWx0O1xuICAgICAgICB2YXIgY291bnQgPSAwO1xuICAgICAgICBmb3IgKHZhciBwcm9wIGluIG9iailcbiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMSAvICsrY291bnQpXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gcHJvcDtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG59Il19